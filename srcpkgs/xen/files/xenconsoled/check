#!/bin/sh

exec > /dev/null
exec 2>&1

# Check for the faux xenconsoled first:
pgrep -f '^shim-xenconsoled' && exit 0

# There's not really a good way to check for xenconsoled being up.
# The best I can come up with is to look at the open FDs, and if
# hypervisor.log is open, then xenconsoled is almost certainly started
# and ready to use.
PID="$(pidof xenconsoled)" || exit 1
expr "x${PID}" ':' 'x[0-9]\+$' > /dev/null || exit 1
ls -l "/proc/${PID}/fd" 2>/dev/null |grep -q hypervisor.log
